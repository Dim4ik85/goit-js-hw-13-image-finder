{"version":3,"sources":["webpack:///./js/Api/apiService.js","webpack:///./index.js","webpack:///./templates/imageList.hbs"],"names":["apiService","this","searchQuery","page","renderedImg","fetchHits","url","BASE_URL","fetch","then","response","json","data","incrementPage","resetPage","newQuery","debounce","require","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","hitsApiService","query","console","log","galleryRequests","options","refs","searchForm","document","querySelector","galleryList","input","sentinel","hits","totalHits","observe","insertAdjacentHTML","imageListTpl","addHitsMarkup","unobserve","clearHitsContainer","innerHTML","addEventListener","e","preventDefault","target","value","trim","length","event","nodeName","changeModalImage","dataset","source","basicLightbox","show","HitsApiService","rootMargin","Handlebars","module","exports","template","container","depth0","helpers","partials","alias1","lambda","alias2","escapeExpression","lookupProperty","parent","propertyName","Object","prototype","hasOwnProperty","call","stack1","nullContext","program","noop"],"mappings":"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","file":"main.d8358e446c5c969c120b.js","sourcesContent":["const BASE_URL = 'https://pixabay.com/api/';\nconst API_KEY = '19367705-6c391461160466e2850694aab';\n\nexport default class apiService {\n    constructor() {\n        this.searchQuery = '';\n        this.page = 1;\n        this.renderedImg = 0;\n    }\n\n    fetchHits() {\n        const url = `${BASE_URL}?key=${API_KEY}&q=${this.searchQuery}&image_type=photo&per_page=12&page=${this.page}`;\n\n        return fetch(url)\n            .then(response => response.json())\n            .then((data) => {\n                this.incrementPage();\n\n                return data;\n            });\n    }\n\n    incrementPage() {\n        this.page += 1;\n    }\n\n    resetPage() {\n        this.page = 1;\n        this.renderedImg = 0;\n    }\n\n    // Если убрать get и set, тогда везьде обращаемся только к searchQuery, a не query \n    get query() {\n        return this.searchQuery;\n    }\n\n    set query(newQuery) {\n        this.searchQuery = newQuery;\n    }\n}","import './css/styles.css';\nimport imageListTpl from './templates/imageList.hbs';\nimport HitsApiService from './js/Api/apiService';\n// import infiniteScroll from 'infinite-scroll';\n// import LoadMoreBtn from './js/loadMoreBtn';\nimport * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\n\nvar debounce = require('lodash.debounce');\n\nconst observer = new IntersectionObserver(onEntry, options);\n\nconst refs ={\n    searchForm: document.querySelector('.search-form'),\n    galleryList: document.querySelector('.gallery'),\n    input: document.querySelector('.search-input'),\n    sentinel: document.querySelector('#sentinel'),\n};\n\n// const loadMoreBtn = new LoadMoreBtn({\n//     selector: '[data-action=\"load-more\"]',\n//     hidden: true,\n// });\n\nrefs.input.addEventListener('input', debounce(onSearch, 500));\n// loadMoreBtn.refs.button.addEventListener('click', onLoadMore);\nrefs.galleryList.addEventListener('click', onGalleryElClick); \n\nfunction onSearch(e) {\n    e.preventDefault();\n\n    hitsApiService.query = e.target.value.trim();\n    if(hitsApiService.query.length === 0) {\n        \n        return clearHitsContainer();\n    } \n\n    // Прячем кнопку\n    // loadMoreBtn.show();\n    hitsApiService.resetPage();\n    clearHitsContainer();\n    onLoadMore(); \n}\n\nfunction onLoadMore() {\n    // loadMoreBtn.disable();\n    hitsApiService.fetchHits().then(galleryRequests);\n}\n\nfunction galleryRequests(data) {\n    console.log(data.hits);\n    // observer.unobserve(refs.sentinel);\n        \n        if(hitsApiService.renderedImg < data.totalHits) {\n            observer.observe(refs.sentinel);\n            addHitsMarkup(data.hits);\n            hitsApiService.renderedImg += 12;\n            // scrollPage();\n            // loadMoreBtn.enable();\n        }\n\n        if(hitsApiService.renderedImg === data.totalHits) {\n            observer.unobserve(refs.sentinel);\n            return;\n        }\n\n        if(hitsApiService.renderedImg + 12 > data.totalHits) {\n            observer.unobserve(refs.sentinel);\n        }\n    }\n\nfunction addHitsMarkup(data) {\n    refs.galleryList.insertAdjacentHTML('beforeend', imageListTpl(data));\n}\n\nfunction clearHitsContainer() {\n refs.galleryList.innerHTML = '';    \n}\n\n// function scrollPage() {\n//       try {\n//         setTimeout(() => {\n//           window.scrollTo({\n//             top: document.body.scrollHeight,\n//             left: 0,\n//             behavior: 'smooth',\n//           });\n//         }, 1000);\n//       } catch (error) {\n//         console.log(error);\n//       }\n//     }\n\n    const hitsApiService = new HitsApiService();\n\n    function onEntry (entries) {\n        entries.forEach(entry => {\n            if (entry.isIntersecting && hitsApiService.query !== '') {\n                console.log(\"LOADING...\");\n                hitsApiService.fetchHits().then(galleryRequests);\n            }\n        });\n    }\n    const options = {\n        rootMargin: '100px'\n    }\n    \n\nfunction onGalleryElClick(event) {\n        if (event.target.nodeName !== 'IMG') {\n          return;\n        }\n        \n        const changeModalImage = `<img src=${event.target.dataset.source} alt=\"icon\" />`;\n        const instance = basicLightbox.create(changeModalImage);\n        instance.show();\n }","var Handlebars = require(\"../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(container,depth0,helpers,partials,data) {\n    var alias1=container.lambda, alias2=container.escapeExpression, lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    };\n\n  return \"<div class=\\\"photo-card\\\">\\n<img src=\\\"\"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"webformatURL\") : depth0), depth0))\n    + \"\\\" data-source=\"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"largeImageURL\") : depth0), depth0))\n    + \" alt=\\\"\"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"tags\") : depth0), depth0))\n    + \"\\\" width=\\\"400\\\" />\\n\\n  <div class=\\\"stats\\\">\\n    <p class=\\\"stats-item\\\">\\n      <i class=\\\"material-icons\\\">thumb_up</i>\\n      \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"likes\") : depth0), depth0))\n    + \"\\n    </p>\\n    <p class=\\\"stats-item\\\">\\n      <i class=\\\"material-icons\\\">visibility</i>\\n      \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"views\") : depth0), depth0))\n    + \"\\n    </p>\\n    <p class=\\\"stats-item\\\">\\n      <i class=\\\"material-icons\\\">comment</i>\\n      \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"comments\") : depth0), depth0))\n    + \"\\n    </p>\\n    <p class=\\\"stats-item\\\">\\n      <i class=\\\"material-icons\\\">cloud_download</i>\\n      \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"downloads\") : depth0), depth0))\n    + \"\\n    </p>\\n  </div>\\n</div>\\n\";\n},\"compiler\":[8,\">= 4.3.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    };\n\n  return ((stack1 = lookupProperty(helpers,\"each\").call(depth0 != null ? depth0 : (container.nullContext || {}),depth0,{\"name\":\"each\",\"hash\":{},\"fn\":container.program(1, data, 0),\"inverse\":container.noop,\"data\":data,\"loc\":{\"start\":{\"line\":1,\"column\":0},\"end\":{\"line\":24,\"column\":9}}})) != null ? stack1 : \"\");\n},\"useData\":true});"],"sourceRoot":""}